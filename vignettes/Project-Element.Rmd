---
title: "Project Element"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Project-Element}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```
The following libraries are needed to create a working EML document. 
```{r, message = FALSE}
library(EDIutils)
library(tidyverse)
library(readxl)
library(EML)
```

# Project 
## Inputs 
## Multipul Funding Sources 
## Other variations on project...think about them 
```{r, include = FALSE}
excel_path <- system.file("extdata", "Hannon-Example", "example-metadata.xlsx", 
                          package = "EDIutils", mustWork = TRUE)

sheets <- readxl::excel_sheets(excel_path)
metadata <- lapply(sheets, function(x) readxl::read_excel(excel_path, sheet = x))
names(metadata) <- sheets

abstract_docx <- system.file("extdata", "Hannon-Example", "hannon_example_abstract.docx", 
                             package = "EDIutils", mustWork = TRUE)

methods_docx <- system.file("extdata", "Hannon-Example", "hannon_example_methods.docx", 
                            package = "EDIutils", mustWork = TRUE)

dataset_file <- system.file("extdata", "Hannon-Example", "hannon_example_physical_data.csv",
                               package = "EDIutils", mustWork = TRUE)

dataset_file_name <- "hannon_example_physical_data.csv"

edi_number <- "edi.687.1"

parent_element <- list()
```
### Project: Title, Personnel, and Funding 
The project section should be appended next. Project personnel and project funding 
are nested in this project section. To generate a valid EML doc the project section 
must contain a project title, a project personnel, and project funding. 

#### Project title
```{r}
project_title <- metadata$project$project_title
```

#### Project personnel 
```{r}
project_personnel_table <- metadata$project
for (i in 1:nrow(project_personnel_table)) {
  current <- project_personnel_table[i, ]
  project_personnel <- add_personnel(parent_element = list(), 
                                     first_name = current$first_name, 
                                     last_name = current$last_name, 
                                     email = current$email,
                                     role = current$role, 
                                     organization = current$organization,
                                     orcid = current$orcid)
}
if (!is.null(project_personnel$associatedParty)) {
  project_personnel <- project_personnel$associatedParty
}
if (!is.null(project_personnel$creator)){
  project_personnel <- project_personnel$creator
}
```

#### Project funding 
The `add_funding` function allows you to append 
both the description of the funding you have received as well as the organization 
you received the funding from. Multiple funders can be appended if necessary and 
information should be added to the "funding" tab in the excel file "example-metadata.xlsx".

```{r}
funding_table <- metadata$funding
for (i in 1:nrow(funding_table)) {
  current <- funding_table[i, ]
  award_information <- add_funding(funder_name = current$funder_name,
                                   funder_identifier = current$funder_identifier,
                                   award_number = current$award_number,
                                   award_title = current$award_title,
                                   award_url = current$award_url,
                                   funding_description = current$funding_description)
} 
```

#### Combining Project Elements
Once all the components of project have been defined we can use the add_project
function to combine the sections in the proper formatting for an EML document. 
```{r}
parent_element <- add_project(parent_element = parent_element,
                              project_title = project_title,
                              award_information = award_information,
                              project_personnel = project_personnel)
``` 

