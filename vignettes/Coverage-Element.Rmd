---
title: "Coverage Element"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Coverage-Element}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```
The following libraries are needed to create a working EML document. 
```{r, message = FALSE}
library(EDIutils)
library(tidyverse)
library(readxl)
library(EML)
```

# COverage 

## Multipule coverages 
## Other coverage complications...think about them 
```{r, include = FALSE}
excel_path <- system.file("extdata", "Hannon-Example", "example-metadata.xlsx", 
                          package = "EDIutils", mustWork = TRUE)

sheets <- readxl::excel_sheets(excel_path)
metadata <- lapply(sheets, function(x) readxl::read_excel(excel_path, sheet = x))
names(metadata) <- sheets

abstract_docx <- system.file("extdata", "Hannon-Example", "hannon_example_abstract.docx", 
                             package = "EDIutils", mustWork = TRUE)

methods_docx <- system.file("extdata", "Hannon-Example", "hannon_example_methods.docx", 
                            package = "EDIutils", mustWork = TRUE)

dataset_file <- system.file("extdata", "Hannon-Example", "hannon_example_physical_data.csv",
                               package = "EDIutils", mustWork = TRUE)

dataset_file_name <- "hannon_example_physical_data.csv"

edi_number <- "edi.687.1"

parent_element <- list()
```
### Coverage: Geographic, Temporal, Taxonomic 
Next, the coverage information is appended. The `add_coverage` function allows
you to append full coverage information to your file. Temporal, Geographic, and 
Taxonomic Coverage are all required elements to generate an EML document. 

##### Taxonomic coverage 
Taxonomic coverage can be appended using the `add_taxonomic_coverage` function. 
The taxonomic coverage information is added to the "example-metadata.xlsx" 
excel file on the tab "taxonomic_coverage". chinook, delta_smelt, steelhead, 
white_sturgeon, and green_sturgeon are all default options that can be selected 
using the drop down menu under the CVPIA_common_species column.
```{r}
taxonomic_coverage <- list()
taxonomic_coverage_table <- metadata$taxonomic_coverage
for (i in 1:nrow(taxonomic_coverage_table)) {
  current <- taxonomic_coverage_table[i, ]
  new_taxon <- add_taxonomic_coverage(CVPIA_common_species = current$CVPIA_common_species,
                                     kingdom_value = current$kingdom_value,
                                     phylum_value = current$phylum_value,
                                     class_value = current$class_value,
                                     order_value = current$order_value,
                                     family_value = current$family_value,
                                     genus_value = current$genus_value,
                                     species_value = current$species_value,
                                     common_name = current$common_name,
                                     taxon_id = current$taxon_id)
  if (is.null(taxonomic_coverage)) {
    taxonomic_coverage <- list(new_taxon)
  } else {
    taxonomic_coverage <- append(taxonomic_coverage, list(new_taxon))
  }
}
```

#### Combining Coverage Elements  
The `add_coverage` function will add all the elements of coverage to the parent 
element. 
```{r}
coverage_table <- metadata$coverage
for (i in 1:nrow(coverage_table)) {
  current <- coverage_table[i, ]
  parent_element <- add_coverage(parent_element = parent_element,
                                 geographic_description = current$geographic_description,
                                 west_bounding_coordinate = current$west_bounding_coordinate,
                                 east_bounding_coordinate = current$east_bounding_coordinate,
                                 north_bounding_coordinate = current$north_bounding_coordinate,
                                 south_bounding_coordinate = current$south_bounding_coordinate,
                                 begin_date = current$begin_date,
                                 end_date = current$end_date,
                                 taxonomic_coverage = taxonomic_coverage)
} 
```